<html>
  <head></head>
  <body>
    <div>
      <div id="categoryBanner">category banner</div>
      <div>
        <ol id="productsList">
          <!-- <li>
            <a href="#">
              <div class="thumbnailImg">
                <img src="" alt="">
              </div>
              <div class="productInfo">
                <div class="titleBox">
                  sample
                </div>
                <div class="priceBox">
                  0
                </div>
                <div class="iconBox">
                  <img src="" alt="">
                </div>
              </div>
            </a>
          </li>
          <li>*5</li> -->
        </ol>
      </div>
    </div>
    <!--
    ajax 통신을 하여 받은 data를
    for문을 돌면서 넣어준다
    * 필요한 함수들
      - ajax 요청해주는 함수
        input
      - 받은 데이터를 dom에 append해주는 함수
        원하는 형태 data 왔는지 확인,
        개수 0? -> 없음 보여주기
        10개 이상? -> 레이지로드 준비
      - 클릭 시 상세 딜로 이동-> a link에 주소
    -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
    var ajaxInfo = {
      url: './pItems.json',
      sendType: 'get',
      param: '',
      successFunc: appendToDom
    };

    //ol 아래의 li length이 1 이하이면, ajax
    function initData(bannerDiv, productsList) {
      if (bannerDiv.children.length === 0) {
        callAjax({
          url: './bannerItems.json',
          sendType: 'get',
          param: '',
          successFunc: appendToDom
        });
      }
      if (productsList.length < 1) {
        callAjax({
          url: './pItems.json',
          sendType: 'get',
          param: '',
          successFunc: appendToDom
        });
      }
    }

    function callAjax(ajaxInfo) {
      $.ajax({
        url: ajaxInfo.url,
        data: ajaxInfo.param,
        dataType: 'json',
        error: function () {
          console.log('in error');
          alert('잠시 후 다시 시도해 주세요.');
        },
        success: function (ajaxRetData) {
          console.log('in success');
          debugger;
          if (ajaxRetData.message !== undefined && ajaxRetData.message !== null) {
            if (ajaxRetData.message === 'OK') {
              ajaxInfo.successFunc(ajaxRetData);
            } else {
              alert('해당 결과가 존재하지 않습니다');
            }
          } else {
            alert('Message not defined');
          }
        },
        type: ajaxInfo.sendType,
        cache: false
      });
    }

    function appendToDom(insertData) {
      debugger;
      var productItems = insertData.productItems;
      var dataLength = productItems.length;
      var appendStr = '';
      var price = 0;
      for (var i = 0; i < dataLength; i++) {
        appendStr +='<li><a href='+productItems[i].url +
        '><div class="thumbnailImg"><img src="' + productItems[i].img.src +
        '" alt="' + productItems[i].img.name + '">' + productItems[i].img.name +
        '</div><div class="productInfo"><div class="titleBox">'+ productItems[i].name;
        if (productItems[i].price.spPrice) {
          price = productItems[i].price.spPrice;
        } else if (productItems[i].price.dPrice) {
          price = productItems[i].price.dPrice;
        } else {
          price = productItems[i].price.nPrice;
        }
        appendStr += '</div><div class="priceBox"><span>'+price+'</span></div>';
        appendSticker(productItems[i].sticker, appendStr);
        $('#productsList').append(appendStr);
        }
    }

    function appendSticker(stickerData, appendStr) {
      for (var j=0; j < stickerData.length; j++) {
        if(stickerData[j]) {
          appendStr += '<div class="iconBox"><img src="' +stickerData[j].src+ '" alt="'+stickerData[j].name+
          '"></div></div>';
        }
      }
      appendStr += '</a></li>';
    }

    initData($('#categoryBanner'), $('#productsList > li'));
    </script>

  </body>
</html>
